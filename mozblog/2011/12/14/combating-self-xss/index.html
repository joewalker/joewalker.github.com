
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Combating Self-XSS - Incompleteness</title>
  <meta name="author" content="Joe Walker">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="canonical" href="http://incompleteness.me//mozblog/2011/12/14/combating-self-xss/"/>
  <link href="/favicon.png" rel="shortcut icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/mozblog/atom.xml" rel="alternate" title="Incompleteness" type="application/atom+xml"/>
  
</head>

<body  >
  <header><!--
<hgroup>
  <h1><a href="/">Incompleteness</a></h1>
</hgroup>
-->

</header>
  <nav role=navigation><ul role=subscription data-subscription="rss">
  <li><a href="/mozblog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="site-search">
    <input type="hidden" name="q" value="site:incompleteness.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul role=main-navigation>
  <li><a href="/">Incompleteness</a></li>
  <li><a href="http://directwebremoting.org/blog/joe/">My other blog</a></li>
  <!--
  <li><a href="/mozblog/archives">Archives</a></li>
  -->
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry">
  
  <header>
    
      <h1 class="entry-title">Combating Self-XSS</h1>
    
  </header>


<div class="entry-content"><h3>What is Self-XSS?</h3>

<p>Dr. Evil has several options for getting his script to execute in the page of
another site. Generically we call this <a href="https://en.wikipedia.org/wiki/Cross-site_scripting">XSS</a>. Self-XSS involves using
social engineering to coerce a user into manually executing javascript using
the location bar or developer tools.
For more, see <a href="https://blogs.msdn.com/themes/blogs/generic/post.aspx?WeblogApp=ieinternals&amp;WeblogPostName=socially-engineered-xss-attacks-and-pasting-javascript-in-the-address-bar-in-ie9">socially-engineered XSS attacks</a>.</p>

<p>The <a href="http://blog.commtouch.com/cafe/web-security/nasty-facebook-picture-attack-based-on-self-xss/">recent Facebook attack</a> signals that something needs to be done, but
knowing the right response is tricky.</p>

<h3>What is Mozilla doing about it?</h3>

<p>We&#8217;re proposing adding a directive to <a href="https://developer.mozilla.org/en/Security/CSP" title="Content Security Policy">CSP</a> that says <em>&#8216;Please disallow
user supplied Javascript in the context of this resource&#8217;</em>.</p>

<p>It will probably look something like this:</p>

<pre><code>X-Content-Security-Policy: no-user-js
</code></pre>

<p>We&#8217;re also going to add a way for developers to opt out of this protection.
Effectively saying <em>&#8216;I can take care of the JavaScript that I ask my browser to
execute&#8217;</em>.</p>

<h3>How does this affect other Firefox developer tools?</h3>

<p>It doesn&#8217;t. <a href="https://hacks.mozilla.org/2011/11/developer-tools-in-firefox-aurora-10/">The Highligher, Style Inspector</a>, <a href="https://wiki.mozilla.org/DevTools/Features/CSSEditor">Style Editor</a> and
<a href="https://blog.mozilla.com/tilt/">Tilt</a> are all unaffected. This is only about JavaScript executed via
the Web Console and <a href="https://blog.mozilla.com/devtools/2011/08/15/introducing-scratchpad/">Scratchpad</a>.</p>

<h3>How does this affect users?</h3>

<div>
<style>
table.custom { border-collapse: collapse; }
table.custom td, table.custom th { border: 1px solid #aaa; padding: 5px; }
table.custom th { text-align: center; font-weight: bold; }
</style>
</div>




<table class=custom>
  <tr>
    <th colspan=2 rowspan=2>User
    <th colspan=2>Is a developer?
  </tr>
  <tr>
    <th>No
    <th>Yes
  </tr>
  <tr>
    <th rowspan=2>Can recognize Self-XSS attack?
    <th>No
    <td>Added Self-XSS attacks protection.
    <td>Warned about Self-XSS, may benefit from protection.
  </tr>
  <tr>
    <th>Yes
    <td>Unchanged
    <td>Minor inconvenience of having to set a preference (one time only) to enable user JavaScript on sites using this Self-XSS protection.
  </tr>
</table>


<p>I think this is a fairly clear net win: Minor, one time only, inconvenience to
a sub-set of web developers, vs. full-time protection for the many that
wouldn&#8217;t recognize a self-xss attack.</p>

<h3>Objections: This is a user problem</h3>

<p>The goal of educating 7 billion people about what JavaScript can do is lofty,
grandiose, ambitious and utterly unattainable. There has to be another solution.</p>

<h3>Objections: This is a Facebook problem</h3>

<p>While it&#8217;s true that allowing untrusted, unvetted third party dynamic content
onto your site is something that I would generally advise against. However I
don&#8217;t think that fixing this would fix the problem. The attack could easily
forward you to another site to see the clipboard injecting flash, before
returning you to the original site for the &#8216;paste&#8217; step</p>

<h3>Objections: This is a Flash problem</h3>

<p>While it&#8217;s true that Adobe&#8217;s clipboard policies are more relaxed than those of
major web browsers, we&#8217;ve seen people caught by instructions that ask people to
select/copy their own attack script. We think that the level of pain caused to
developers by the CSP solution is low enough that we can justify the additional
protection.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Joe Walker</span></span>

      





  



<time datetime="2011-12-14T12:00:00+00:00" pubdate  data-updated="true" >Dec 14<span>th</span>, 2011</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://incompleteness.me/mozblog/2011/12/14/combating-self-xss/" data-via="joewalker" data-counturl="http://incompleteness.me/mozblog/2011/12/14/combating-self-xss/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
</div>

    
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread"><div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_shortname = 'incompletenessme';
  var disqus_identifier = 'http://incompleteness.me/mozblog/2011/12/14/combating-self-xss/';
  var disqus_url = 'http://incompleteness.me/mozblog/2011/12/14/combating-self-xss/';
  //var disqus_developer = 1;
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside role=sidebar>
  
    
<section>

  <h1>About</h1>
  <p>
    I'm Joe Walker. I work for Mozilla making developer tools better
    i.e. creating tomorrow's Firebug.
  </p>
  <p>
    This blog is just about Mozilla stuff. If that's not you, try my
    <a href="http://directwebremoting.org/blog/joe/">other blog</a> which is
    of wider tech interest.
  </p>
  <p>
    See also <a href="https://github.com/joewalker">joewalker</a> on Github
    and <a href="https://twitter.com/joewalker">@joewalker</a> on Twitter, and
    <a href="https://plus.google.com/103130341946168853745/posts">103130341946168853745</a>
    on Google+.
  </p>

  <h1>Projects</h1>
  <ul>
    <li>
      <a href="https://github.com/joewalker/gcli">GCLI</a> is a web developers
      command-line that's being used in Firefox Developer Tools, and alongside
      Ace
    </li>
    <li>
      <a href="https://github.com/joewalker/domtemplate">DOM Template</a>
      is an experimental DOM template engine with some nice features like
      asynchronous layout
    </li>
    <li>
      <a href="https://github.com/joewalker/csstools">CSS Doctor</a> is an
      experiment into how we can improve the CSS telemetry in a browser
    </li>
    <li>
      <a href="http://directwebremoting.org/dwr/index.html">DWR</a> is a Java
      library that enables Java on the server and JavaScript in a browser to
      interact and call each other as simply as possible
    </li>
  </ul>

</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/mozblog/2011/12/14/combating-self-xss/">Combating Self-XSS</a>
      </li>
    
      <li class="post">
        <a href="/mozblog/2011/09/16/how-to-eat-an-elephant/">How to Eat an Elephant</a>
      </li>
    
      <li class="post">
        <a href="/mozblog/2010/09/13/marketing-according-to-the-browser-makers/">Marketing (according to the browser makers)</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("joewalker", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/joewalker" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @joewalker</a>
  
</section>


  
</aside>


    </div>
  </div>
  <footer><p>
  Copyright &copy; 2011 - Joe Walker -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

  
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


</body>
</html>
